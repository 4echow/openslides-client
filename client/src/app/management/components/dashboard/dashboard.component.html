<os-head-bar>
    <!-- Title -->
    <div class="title-slot">
        <h2>{{ 'Calendar' | translate }}</h2>
    </div>
</os-head-bar>

<div class="meeting-list-container">
    <div class="pseudo-icon-spacer"></div>
    <div class="orga-information">
        <div class="orga-name title-font foreground-accent">{{ orgaName }}</div>
        <div class="orga-description">{{ orgaDescription }}</div>
    </div>
</div>

<mat-card *ngIf="noMeetingsToShow" class="no-content os-card">
    <i>{{ 'No meetings available' | translate }}</i>
</mat-card>

<ng-container *ngIf="!noMeetingsToShow">
    <!-- active meetings -->
    <div id="active-meetings" class="meeting-list-container">
        <div class="meeting-icon-wrapper foreground-accent">
            <mat-icon color="accent">access_alarm</mat-icon>
            <span>{{ 'active' | translate }}</span>
        </div>
        <div class="meeting-list background-card">
            <mat-card class="no-meetings-card" *ngIf="!currentMeetings.length">
                {{ 'No meetings available' | translate }}
            </mat-card>
            <ng-container *ngFor="let meeting of currentMeetings; let last = last">
                <ng-container
                    [ngTemplateOutlet]="meetingTemplate"
                    [ngTemplateOutletContext]="{
                        meeting: meeting,
                        cssClass: 'background-accent foreground-accent-contrast'
                    }"
                ></ng-container>
                <mat-divider *ngIf="!last"></mat-divider>
            </ng-container>
        </div>
    </div>

    <!-- future meetings -->
    <div id="future-meetings" class="meeting-list-container">
        <div class="meeting-icon-wrapper foreground-primary">
            <mat-icon color="primary">update</mat-icon>
            <span>{{ 'future' | translate }}</span>
        </div>
        <ng-container
            [ngTemplateOutlet]="meetingListTemplate"
            [ngTemplateOutletContext]="{ meetingList: futureMeetings }"
        ></ng-container>
    </div>

    <!-- previous meetings -->
    <div id="previous-meetings" class="meeting-list-container">
        <div class="meeting-icon-wrapper">
            <mat-icon aria-hidden="true">history</mat-icon>
            <span>{{ 'ended' | translate }}</span>
        </div>
        <ng-container
            [ngTemplateOutlet]="meetingListTemplate"
            [ngTemplateOutletContext]="{ meetingList: previousMeetings }"
        ></ng-container>
    </div>

    <!-- meetings with no date -->
    <div id="no-date-meetings" class="meeting-list-container">
        <div class="meeting-icon-wrapper">
            <mat-icon aria-hidden="true">watch_later</mat-icon>
            <span>{{ 'dateless' | translate }}</span>
        </div>
        <ng-container
            [ngTemplateOutlet]="meetingListTemplate"
            [ngTemplateOutletContext]="{ meetingList: noDateMeetings }"
        ></ng-container>
    </div>
</ng-container>

<ng-template let-meetingList="meetingList" #meetingListTemplate>
    <div class="meeting-list" [ngStyle]="{ height: getHeightByMeetings(meetingList) }">
        <mat-card class="no-meetings-card" *ngIf="!meetingList.length">
            {{ 'No meetings available' | translate }}
        </mat-card>
        <cdk-virtual-scroll-viewport [itemSize]="60" *ngIf="!!meetingList.length">
            <ng-container *cdkVirtualFor="let meeting of meetingList; let odd = odd; let last = last">
                <div [ngClass]="{ alternate: odd }">
                    <ng-container
                        [ngTemplateOutlet]="meetingTemplate"
                        [ngTemplateOutletContext]="{ meeting: meeting }"
                    ></ng-container>
                </div>
            </ng-container>
        </cdk-virtual-scroll-viewport>
    </div>
</ng-template>

<ng-template let-meeting="meeting" let-cssClass="cssClass" #meetingTemplate>
    <div matRipple class="meeting-box" [ngClass]="cssClass" [routerLink]="meeting.id">
        <div class="meeting-box--left" *ngIf="!isPhone">
            <ng-container *ngTemplateOutlet="meetingTime; context: { meeting: meeting }"></ng-container>
        </div>
        <div class="meeting-box--mid">
            {{ meeting.name }}

            <div *ngIf="isPhone" class="meeting-box--information-phone">
                <span>
                    <ng-container *ngTemplateOutlet="meetingTime; context: { meeting: meeting }"></ng-container>
                </span>
                <span>
                    {{ meeting.location }}
                </span>
            </div>
        </div>
        <div class="meeting-box--right" *ngIf="!isPhone">{{ meeting.location }}</div>
    </div>
</ng-template>

<ng-template let-meeting="meeting" #meetingTime>
    <os-meeting-time [meeting]="meeting"></os-meeting-time>
</ng-template>
